<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1>üè∑Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏</h1>
        <canvas id="sparkleCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;"></canvas>
        <a href="/" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–æ–¥–∞–º</a>
    </header>

    <main class="container">
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞ -->
        <div class="tag-form">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥</h2>
            <form action="/add_tag" method="POST">
                <div class="form-group">
                    <input type="text" name="tag_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)" 
                           required maxlength="50">
                </div>
                <button type="submit" class="tag-btn tag-btn-add">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</button>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ -->
        <div class="tags-list">
            <h2>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–≥–∏ ({{ tags|length }})</h2>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {% if tags %}
                <table class="tags-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tag in tags %}
                        <tr>
                            <td>
                                <a href="/filter_by_tag/{{ tag[0] }}" class="tag-link">{{ tag[1] }}</a>
                            </td>
                            <td>
                                <form action="/edit_tag/{{ tag[0] }}" method="POST" class="edit-form">
                                    <input type="text" name="tag_name" value="{{ tag[1] }}" 
                                        class="tag-input" maxlength="50">
                                    <button type="submit" class="tag-btn tag-btn-save">üíæ</button>
                                </form>
                            </td>
                            <td>{{ tag[2] if tag[2] else 'N/A' }}</td>
                            <td>
                                <form action="/delete_tag/{{ tag[0] }}" method="POST" 
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–µ–≥ &quot;{{ tag[1] }}&quot;? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—ã –ø–æ—Ç–µ—Ä—è—é—Ç —ç—Ç–æ—Ç —Ç–µ–≥.')">
                                    <button type="submit" class="tag-btn tag-btn-delete">üóëÔ∏è</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="empty">–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</p>
            {% endif %}
        </div>
    </main>

    <script>
    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.querySelector('input[name="tag_name"]');
        if (input) input.focus();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ enter –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.querySelectorAll('.edit-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const input = this.querySelector('input');
                if (input.value.trim().length < 2) {
                    e.preventDefault();
                    alert('–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                }
            });
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('sparkleCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä header
        const resizeCanvas = () => {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        };
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // === –ú–µ–ª–∫–∏–µ –±–ª–µ—Å—Ç–∫–∏ (80 —à—Ç) ===
        const sparkles = [];
        const count = 500;

        for (let i = 0; i < count; i++) {
            sparkles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                baseRadius: Math.random() * 0.3 + 0.1, // 0.5‚Äì1.5px
                pulseSpeed: Math.random() * 4 + 3, // 0.5‚Äì1.3 –ì—Ü
                phase: Math.random() * Math.PI * 2,
            });
        }

        // === –ê–Ω–∏–º–∞—Ü–∏—è ===
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const t = Date.now() / 1000;

            // –†–∏—Å—É–µ–º –º–µ–ª–∫–∏–µ –±–ª–µ—Å—Ç–∫–∏
            for (const s of sparkles) {
                const pulse = Math.sin(t * s.pulseSpeed + s.phase) * 0.5 + 0.5; // 0 ‚Üí 1
                const radius = s.baseRadius * (1 + pulse * 0.8);
                const opacity = 0.3 + pulse * 0.7;

                ctx.beginPath();
                ctx.arc(s.x, s.y, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                ctx.fill();

                // –§–∏–æ–ª–µ—Ç–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowBlur = 10 * pulse;
                ctx.shadowColor = `rgba(139, 92, 246, ${pulse * 0.6})`;
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            requestAnimationFrame(animate);
        }

        animate();
    });
    </script>
</body>
</html>